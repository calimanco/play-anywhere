# play-anywhere

[![Build Status](https://travis-ci.com/calimanco/play-anywhere.svg?branch=main)](https://travis-ci.com/calimanco/play-anywhere)
[![NPM](https://img.shields.io/npm/l/play-anywhere)](https://www.npmjs.com/package/play-anywhere)
[![npm](https://img.shields.io/npm/v/play-anywhere)](https://www.npmjs.com/package/play-anywhere)
[![JavaScript Style Guide](https://img.shields.io/badge/code_style-standard-brightgreen.svg)](https://standardjs.com)

## Intro

A simple zero-configuration command-line webpack dev server.  
No need to write HTML and styles, focus on scripting, and automatically generate multi-page applications.  
It can be used to quickly verify ideas, show cases, local development, and testing.  

---

[English Version](https://github.com/calimanco/play-anywhere/blob/main/README_EN.md)

## Install

### Globally via npm

```bash
npm install play-anywhere -g
```

This is the recommended practice so that play-anywhere can be run anywhere via the command line.  

### As a dependency in your npm package

```bash
npm install play-anywhere
```

## Usage

```bash
play-anywhere [path] [options]
#or
pa [path] [options]
```

`path` optional, the default is the directory where the current command line is run, that is, `./`;  
`options` optional, [available options](#available-options).  
The program will scan the files within `path` (non-recursively) and generate webpack entries, which are divided into "simple mode" and "complete mode".  

### Simple Mode

- JS or TS file in the `path` directory, file name of which will be used to generate entry and page;
- Pages can only be generated by built-in templates.

### Complete Mode

- The subdirectory in the path directory, which contains `app.js` or `app.ts`, and the file name will be used to generate entries and pages;
- If there are still `index.html`, `index.htm` or `index.ejs` in the subdirectory, it will replace the default template to generate the page.

For example, suppose there is the following directory structure:  

```
demo
├── first.ts     (simple mode)
├── second       (complete mode)
│   └── app.ts
└── third        (complete mode)
    ├── index.ejs
    └── app.js
```

Will generate the following three webpack entrances and web pages with the same name.  
The server listens to port 3000 by default.  
The homepage `http://localhost:3000` will list the results. The mapping relationship is as follows:  

```
first   =>  http://localhost:3000/first
second  =>  http://localhost:3000/second
third   =>  http://localhost:3000/third
```

## Features

- Supports TypeScript, CSS and EJS templates by default;
- Only a JS or TS file is needed to automatically generate a page, and it also supports customization;
- Webpack HMR is configured;
- Support static file service;
- Configuration can be fully customized.

## Available Options

- `-p [number]` / `--port [number]` Port to use (defaults to 8080). It will also read from `process.env.PORT`.
- `-h` / `--help` Print this list and exit.
- `-v` / `--version` Print the version and exit.
- `-s` / `--silent` Suppress log messages from output. Webpack will still print a little.
- `--static-dir [path]` Set up a static directory, which can be used for the use of some static resources.
- `-c --config [path]` The configuration file that needs to be read, the configuration will be merged with the default configuration.

## Full Configuration

The default configuration has been able to meet most of the needs, but if you need to customize it completely, you can write the configuration file yourself. The configuration file is a CommonJS module file.  
All options are optional. When encountering a field with the same function as a command line option, the command line input will take precedence.    
Please use an absolute path.  

```typescript
interface PaConfig {
  // Debug switch.
  debug?: boolean
  // Silent switch. The same as "-s / --silent" CMD option.
  silent?: boolean
  // Specify the root directory. The default is the directory where the CMD is currently running.
  root?: string
  // Specify the static directory. The same as "--static-dir" CMD option.
  staticDir?: string
  // Specify the server port. The same as "-p / --port" CMD option.
  serverPort?: number
  // Specify homepage html template file.
  indexTemplate?: string
  // Specify subpage html template file.
  pageTemplate?: string
  // Matching rules for entry files.
  entryMatch?: Array<string | RegExp>
  // Matching rules for html template files.
  templateMatch?: Array<string | RegExp>
  // Matching rules for exclude files.
  exclude?: Array<string | RegExp>
  // The config of webpack. It will use 'webpack-merge' to merge.
  webpackConfig?: Configuration
}
```

## Custom HTML

By default, HTML is generated by built-in templates, namely indexTemplate and pageTemplate. It is generally not recommended modifying the general template.  
If you want to customize the HTML, you can write `index.htm`, `index.html` or `index.ejs` (default rules) in a subdirectory.  
The custom style can be directly referenced in the script file, and it will be processed by `style-loader` and `css-loader`.  
The following directory structure can be formed:  

```
demo
└── third
    ├── app.js （import style.css here）
    ├── style.css
    └── index.ejs
```

## Custom Matching Rules

The matching rule is only valid in "full mode". The rule consists of three parts, `entryMatch`, `templateMatch` and `exclude`.  
They are each a regular/string array, and the matching priority is from left to right. The newly added rule will be "unshifted" into the old rule list, that is, the new rule takes precedence over the old rule.  

- `entryMatch`  It is used to match the entry file, that is, if there is a matching file in the subdirectory, it will be judged to be processed in the "full mode". The default is `[/^app\.(ts|js)$/i]` ;
- `templateMatch`  It is used to match HTML template files. It can only be matched after the previous condition is met. The default is `[/^index\.(htm|html|ejs)$/i]` ;
- `exclude`  The directory or file that needs to be excluded. This rule is also used to search for the root directory and subdirectories. The default is `[/^node_modules$/i, /^\./i]` .


## Static File

You may load some files in the web page that do not need to be processed by Webpack, you can set a directory as a static file directory.  
For example, the following files:  

```
demo
├── public
│   └── other.js
└── third
    ├── app.js
    └── index.ejs
```

Execute the command:  

```bash
play-anywhere demo --static-dir demo/public
```

You can use `public/other.js` in `third/index.ejs`:  

```html
<script src="/other.js"></script>
```

## Q & A

#### Q：When both `app.js` and `app.ts` exist in a subdirectory, which one will be the entry file?

A：Since the order in which NodeJS reads files is random, the matching result is also random. Please try to avoid the use of this situation.  

## LICENSE

MIT
